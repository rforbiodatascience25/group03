---
title: "lab07"
format: html
---

Import libraries

```{r}
library(tidyverse)
library(broom) 
library(cowplot)
```

Import biopsy database

```{r}
biopsy <- read_csv("https://wilkelab.org/classes/SDS348/data_sets/biopsy.csv")
```

Only keep numeric values and scale

```{r}
pca_fit <- biopsy %>% 
  select(where(is.numeric)) %>%
  prcomp(scale = TRUE) 
```

Plot 1: malingnant and benign classification biopsy

```{r}
options(bitmapType = "cairo")
pca_fit %>%
  augment(biopsy) %>% 
  ggplot(aes(.fittedPC1, .fittedPC2, color = outcome)) + 
  geom_point(size = 1.5) +
  scale_color_manual(
    values = c(malignant = "#FF00FF", benign = "#0000FF")
  ) +
  theme_half_open(12) + background_grid()
```
Explanation: Seems like PC1 explains most of the variance in the data (see plot 3 for more info). We are able to distinguish between the benign and malignant categories quite well, although there is still some overlap.

Plot 2: description of founded cells

```{r}
arrow_style <- arrow(
  angle = 20, ends = "first", type = "closed", length = grid::unit(8, "pt")
)

# plot rotation matrix
pca_fit %>%
  tidy(matrix = "rotation") %>%
  pivot_wider(names_from = "PC", names_prefix = "PC", values_from = "value") %>%
  ggplot(aes(PC1, PC2)) +
  geom_segment(xend = 0, yend = 0, arrow = arrow_style) +
  geom_text(
    aes(label = column),
    hjust = 1, nudge_x = -0.02, 
    color = "#FF00FF"
  ) +
  xlim(-1.25, .5) + ylim(-.5, 1) +
  coord_fixed() + # fix aspect ratio to 1:1
  theme_minimal_grid(12)
```
Explanation: The variable "mitoses" is the main variable in PC2 and PC2 therefore is somewhat a representation of "mitoses", although other variables such as "bare_nuclei" or "bland_chromatin" also contribute to this component. PC1, however, seems to cover the rest of the variables, indicating some possible cross-correlation between some of the variables. It is probable that PC1 represents a biological characteristic relating to the state of the cell.

Plot 3:

The goal is to plot the proportion of variance explained by each principal component.

```{r}
pca_fit %>%
  tidy(matrix = "eigenvalues") %>%
  ggplot(aes(PC, percent, fill = factor(PC == 1))) +
  geom_col(alpha = 0.8) +
  scale_fill_manual(
    values = c("TRUE" = "#D55E00", "FALSE" = "#56B4E9"),
    guide = "none" 
  ) +
  scale_x_continuous(breaks = 1:9) +
  scale_y_continuous(
    labels = scales::percent_format(),
    expand = expansion(mult = c(0, 0.01))
  ) +
  labs(
    title = "Variance Explained by Principal Components",
    x = "Principal Component",
    y = "Variance Explained (in %)"
  ) +
  theme_minimal_hgrid(12)


```{r}
pca_fit <- biopsy %>% 
  select(where(is.numeric)) %>%
  prcomp(scale = TRUE) 
```

We see that PC1 (displayed in orange) explains roughly 65% of the variance, which is why it separates benign vs malignant samples well.

\
The other PCs (displayed in blue) explain less and less indicating that the contribution is lower for other PCs.

PC1 is by far the PC that explains most of the variability, and the rest of the PCs explain a low percentage of the variability. This might suggest that reducing the dimensionality of the dataset to the first n PCs (n could be 2, 3 or 4) might be enough to capture the variability in the dataset and therefore be able to perform classification. 
